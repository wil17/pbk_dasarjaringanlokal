(this["webpackJsonpall-in-one"]=this["webpackJsonpall-in-one"]||[]).push([[1],{841:function(e,t,i){"use strict";i.r(t);var n=i(28),s=i(91),a=i(63),o=i(138),d=i(6),r=i(36),c=i(26);let E;!function(e){e.GET_PROGRESS="GET_PROGRESS",e.SET_PROGRESS="SET_PROGRESS",e.PROGRESS_RESPONSE="PROGRESS_RESPONSE",e.VIDEO_COMPLETED="VIDEO_COMPLETED",e.PAUSE_VIDEO="PAUSE_VIDEO"}(E||(E={}));var O=i(16),h=i(228),l=i(88),u=i(12);var S=new class{constructor(){this.iframeOrigin="",this.actions=void 0,this.videoIframeIds=new Set,this.parentListener=async e=>{if(this.isDevToolsEvent(e))return;if(this.setIframeOrigin(e),!this.doesOriginMatch(e))return;const t=e.data,i=t.type,n=t.value;if(!n)return;const s=n.videoId,a=n.questionId,o=n.progressedTime,d=s.split("_"),c=Object(r.a)(d,3),O=c[1],h=c[2];switch(i){case E.GET_PROGRESS:this.handleGetProgress(s,O,h);break;case E.SET_PROGRESS:await this.handleSetProgress(s,o,a);break;case E.VIDEO_COMPLETED:await this.handleVideoCompletion(s,a,h);break;default:console.warn("unhandled message type: ".concat(i))}}}initialize(e){this.actions=e,window.addEventListener("message",this.parentListener)}onContentLoaded(e){e.questionIds.forEach(e=>{this.initializeVideoWatchStatus(e),this.markInformationContentExperienced(e)})}onContentQuestionOpen(e){let t=e.questionId;const i=Object(O.L)(s.a.getState(),t).hasVideo;(!i||i&&Object(O.Z)(s.a.getState(),t))&&this.actions.informationContentExperienced(t)}pauseVideos(){[...this.videoIframeIds].forEach(e=>{const t=document.getElementById(e);var i;t&&(null===(i=t.contentWindow)||void 0===i||i.postMessage({type:E.PAUSE_VIDEO},this.iframeOrigin))})}cleanup(){window.removeEventListener("message",this.parentListener)}initializeVideoWatchStatus(e){const t=Object(O.L)(s.a.getState(),e).videoCount,i=Array(t).fill(!1);s.a.dispatch({type:h.a.SET_QUESTION_TOTAL_VIDEOS_WATCHED,payload:{questionId:e,totalVideosWatched:i}})}markInformationContentExperienced(e){const t=Object(O.L)(s.a.getState(),e).hasVideo,i=Object(O.v)(s.a.getState(),e).type===u.d;Object(O.R)(s.a.getState(),e)&&!Object(O.ib)(s.a.getState(),e)&&!t&&i&&this.actions.informationContentExperienced(e)}markVideoAsWatched(e,t,i){if(!i)return;this.videoIframeIds.delete(e);const n=[...Object(O.M)(s.a.getState(),t)];n[i]=!0,s.a.dispatch({type:h.a.SET_QUESTION_TOTAL_VIDEOS_WATCHED,payload:{questionId:t,totalVideosWatched:n}})}handleGetProgress(e,t,i){if(!Object(l.e)(+t)||!Object(l.e)(+i))return;const n=document.getElementById(e);if(n){var s,a;this.videoIframeIds.add(e);const o=c.a.getVideoProgress(),d=o&&(null===(s=o[+t])||void 0===s?void 0:s[+i])||0;null===(a=n.contentWindow)||void 0===a||a.postMessage({type:E.PROGRESS_RESPONSE,value:d},this.iframeOrigin)}}async handleSetProgress(e,t,i){if(null===t)return;const n=[...Object(O.M)(s.a.getState(),i)];d.a.emit(d.b.VIDEO_PROGRESSED,{videoProgress:{videoId:e,progressedTime:t,totalVideosWatched:n},state:s.a.getState()})}async handleVideoCompletion(e,t,i){i&&(this.markVideoAsWatched(e,t,i),Object(O.Z)(s.a.getState(),t)&&this.actions.informationContentExperienced(t))}isDevToolsEvent(e){var t;return null===(t=e.data.source)||void 0===t?void 0:t.includes("react-devtools")}setIframeOrigin(e){const t=e.data.type;!this.iframeOrigin&&Object.values(E).includes(t)&&(this.iframeOrigin=e.origin)}doesOriginMatch(e){return e.origin===this.iframeOrigin}};class p extends o.a{constructor(){super(),this.handlers=void 0,this.handlers=[{event:d.b.VIDEO_RESTRICTION_ON_CONTENT_LOADED,instance:this.onContentLoaded.bind(this)},{event:d.b.VIDEO_RESTRICTION_ON_CONTENT_OPENED,instance:this.onContentQuestionOpen.bind(this)},{event:d.b.VIDEO_RESTRICTION_PAUSE_VIDEOS,instance:this.pauseVideos.bind(this)}]}initialize(e){S.initialize(e)}onContentLoaded(e){let t=e.questionIds;S.onContentLoaded({questionIds:t})}onContentQuestionOpen(e){let t=e.questionId;S.onContentQuestionOpen({questionId:t})}pauseVideos(){S.pauseVideos()}cleanup(){S.cleanup()}}t.default=new class{constructor(){this.eventHandler=void 0,this.eventHandler=new p}subscribe(){const e=Object(n.b)(a,s.a.dispatch);this.eventHandler.on(),this.eventHandler.initialize(e)}unsubscribe(){this.eventHandler.off(),this.eventHandler.cleanup()}}}}]);